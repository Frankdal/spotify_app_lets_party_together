function cov_16c1db1u6m(){var path="D:\\Mag\\lets_party_together\\potential-badass-app\\server\\plugins\\listManager.js";var hash="385faad46461ef65603ce47a9064e0002c8b7bf7";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Mag\\lets_party_together\\potential-badass-app\\server\\plugins\\listManager.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:36}},"1":{start:{line:2,column:16},end:{line:2,column:34}},"2":{start:{line:3,column:16},end:{line:3,column:36}},"3":{start:{line:6,column:1},end:{line:74,column:4}},"4":{start:{line:7,column:17},end:{line:7,column:19}},"5":{start:{line:8,column:2},end:{line:10,column:5}},"6":{start:{line:9,column:3},end:{line:9,column:33}},"7":{start:{line:14,column:17},end:{line:14,column:67}},"8":{start:{line:15,column:2},end:{line:19,column:6}},"9":{start:{line:16,column:3},end:{line:19,column:6}},"10":{start:{line:21,column:2},end:{line:21,column:12}},"11":{start:{line:22,column:2},end:{line:27,column:5}},"12":{start:{line:23,column:17},end:{line:23,column:19}},"13":{start:{line:24,column:3},end:{line:24,column:32}},"14":{start:{line:25,column:3},end:{line:25,column:26}},"15":{start:{line:26,column:3},end:{line:26,column:22}},"16":{start:{line:30,column:2},end:{line:30,column:45}},"17":{start:{line:31,column:2},end:{line:31,column:50}},"18":{start:{line:32,column:2},end:{line:32,column:37}},"19":{start:{line:33,column:2},end:{line:33,column:32}},"20":{start:{line:35,column:21},end:{line:35,column:47}},"21":{start:{line:36,column:2},end:{line:36,column:60}},"22":{start:{line:36,column:41},end:{line:36,column:58}},"23":{start:{line:42,column:13},end:{line:42,column:34}},"24":{start:{line:43,column:2},end:{line:43,column:20}},"25":{start:{line:45,column:16},end:{line:45,column:18}},"26":{start:{line:46,column:2},end:{line:52,column:3}},"27":{start:{line:47,column:19},end:{line:47,column:20}},"28":{start:{line:48,column:22},end:{line:48,column:29}},"29":{start:{line:49,column:21},end:{line:49,column:47}},"30":{start:{line:50,column:16},end:{line:50,column:54}},"31":{start:{line:51,column:3},end:{line:51,column:24}},"32":{start:{line:53,column:2},end:{line:53,column:38}},"33":{start:{line:53,column:25},end:{line:53,column:36}},"34":{start:{line:54,column:2},end:{line:54,column:23}},"35":{start:{line:56,column:14},end:{line:56,column:16}},"36":{start:{line:58,column:2},end:{line:60,column:3}},"37":{start:{line:59,column:3},end:{line:59,column:58}},"38":{start:{line:64,column:18},end:{line:64,column:23}},"39":{start:{line:68,column:26},end:{line:72,column:3}},"40":{start:{line:73,column:2},end:{line:73,column:76}},"41":{start:{line:82,column:0},end:{line:85,column:2}}},fnMap:{"0":{name:"rearrangePlaylist",decl:{start:{line:5,column:9},end:{line:5,column:26}},loc:{start:{line:5,column:52},end:{line:75,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:6,column:20},end:{line:6,column:21}},loc:{start:{line:6,column:48},end:{line:74,column:2}},line:6},"2":{name:"(anonymous_2)",decl:{start:{line:8,column:15},end:{line:8,column:16}},loc:{start:{line:8,column:26},end:{line:10,column:3}},line:8},"3":{name:"(anonymous_3)",decl:{start:{line:22,column:34},end:{line:22,column:35}},loc:{start:{line:22,column:41},end:{line:27,column:3}},line:22},"4":{name:"(anonymous_4)",decl:{start:{line:36,column:34},end:{line:36,column:35}},loc:{start:{line:36,column:41},end:{line:36,column:58}},line:36},"5":{name:"(anonymous_5)",decl:{start:{line:53,column:15},end:{line:53,column:16}},loc:{start:{line:53,column:25},end:{line:53,column:36}},line:53}},branchMap:{"0":{loc:{start:{line:15,column:2},end:{line:19,column:6}},type:"if",locations:[{start:{line:15,column:2},end:{line:19,column:6}},{start:{line:15,column:2},end:{line:19,column:6}}],line:15}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"385faad46461ef65603ce47a9064e0002c8b7bf7"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_16c1db1u6m=function(){return actualCoverage;};}return actualCoverage;}cov_16c1db1u6m();const spotify=(cov_16c1db1u6m().s[0]++,require("./spotify"));const skmeans=(cov_16c1db1u6m().s[1]++,require("skmeans"));const{map}=(cov_16c1db1u6m().s[2]++,require("../server"));function rearrangePlaylist(playlistId,token,data){cov_16c1db1u6m().f[0]++;cov_16c1db1u6m().s[3]++;return new Promise(async(resolve,rejexct)=>{cov_16c1db1u6m().f[1]++;let trackIds=(cov_16c1db1u6m().s[4]++,[]);cov_16c1db1u6m().s[5]++;data.forEach(track=>{cov_16c1db1u6m().f[2]++;cov_16c1db1u6m().s[6]++;trackIds.push(track.track.id);});// trackIds = removeDuplicates(trackIds);
let features=(cov_16c1db1u6m().s[7]++,await spotify.getFeaturesOfTracks(trackIds,token));cov_16c1db1u6m().s[8]++;if(features.status){cov_16c1db1u6m().b[0][0]++;cov_16c1db1u6m().s[9]++;resolve({status:features.status,message:"Couldn't get the features: "+features.statusMessage});}else{cov_16c1db1u6m().b[0][1]++;}// console.log(features);
cov_16c1db1u6m().s[10]++;data=[];cov_16c1db1u6m().s[11]++;features.audio_features.forEach(f=>{cov_16c1db1u6m().f[3]++;let newData=(cov_16c1db1u6m().s[12]++,[]);cov_16c1db1u6m().s[13]++;newData.push(f.danceability);cov_16c1db1u6m().s[14]++;newData.push(f.energy);cov_16c1db1u6m().s[15]++;data.push(newData);});// console.log(data);
cov_16c1db1u6m().s[16]++;numOfClusters=Math.ceil(data.length/3);cov_16c1db1u6m().s[17]++;clusteringResult=skmeans(data,numOfClusters);cov_16c1db1u6m().s[18]++;console.log("Clustering result: ");cov_16c1db1u6m().s[19]++;console.log(clusteringResult);let avgCentroids=(cov_16c1db1u6m().s[20]++,clusteringResult.centroids);cov_16c1db1u6m().s[21]++;avgCentroids=avgCentroids.map(x=>{cov_16c1db1u6m().f[4]++;cov_16c1db1u6m().s[22]++;return(x[0]+x[1])/2;});// console.log("Centroids: ")
// console.log(avgCentroids);
// i assign to every idx the average value of the centroid, then i sort
// the list in decrescent order.
let idxs=(cov_16c1db1u6m().s[23]++,clusteringResult.idxs);cov_16c1db1u6m().s[24]++;console.log(idxs);let newIdxs=(cov_16c1db1u6m().s[25]++,[]);cov_16c1db1u6m().s[26]++;for(i=0;i<idxs.length;i++){let songIndex=(cov_16c1db1u6m().s[27]++,i);let clusterIndex=(cov_16c1db1u6m().s[28]++,idxs[i]);let avgCentroid=(cov_16c1db1u6m().s[29]++,avgCentroids[clusterIndex]);let newRow=(cov_16c1db1u6m().s[30]++,[songIndex,clusterIndex,avgCentroid]);cov_16c1db1u6m().s[31]++;newIdxs.push(newRow);}cov_16c1db1u6m().s[32]++;newIdxs.sort((a,b)=>{cov_16c1db1u6m().f[5]++;cov_16c1db1u6m().s[33]++;return b[2]-a[2];});cov_16c1db1u6m().s[34]++;console.log(newIdxs);let songs=(cov_16c1db1u6m().s[35]++,[]);cov_16c1db1u6m().s[36]++;for(i=0;i<features.audio_features.length;i++){cov_16c1db1u6m().s[37]++;songs.push(features.audio_features[newIdxs[i][0]].uri);}// console.log('Clusters: ');
// console.log(clusters);
let trackUris=(cov_16c1db1u6m().s[38]++,songs);// console.log("Songs uris: ");
// console.log(trackUris);
let replacementResult=(cov_16c1db1u6m().s[39]++,await spotify.replacePlaylistSongs(playlistId,trackUris,token));cov_16c1db1u6m().s[40]++;resolve({status:replacementResult.status,message:replacementResult});});}// function removeDuplicates(array) {
// 	let newArray = array.filter((v, i) => array.indexOf(v) == i);
// 	return newArray;
// }
cov_16c1db1u6m().s[41]++;module.exports={rearrangePlaylist// removeDuplicates,
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpc3RNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbInNwb3RpZnkiLCJyZXF1aXJlIiwic2ttZWFucyIsIm1hcCIsInJlYXJyYW5nZVBsYXlsaXN0IiwicGxheWxpc3RJZCIsInRva2VuIiwiZGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZXhjdCIsInRyYWNrSWRzIiwiZm9yRWFjaCIsInRyYWNrIiwicHVzaCIsImlkIiwiZmVhdHVyZXMiLCJnZXRGZWF0dXJlc09mVHJhY2tzIiwic3RhdHVzIiwibWVzc2FnZSIsInN0YXR1c01lc3NhZ2UiLCJhdWRpb19mZWF0dXJlcyIsImYiLCJuZXdEYXRhIiwiZGFuY2VhYmlsaXR5IiwiZW5lcmd5IiwibnVtT2ZDbHVzdGVycyIsIk1hdGgiLCJjZWlsIiwibGVuZ3RoIiwiY2x1c3RlcmluZ1Jlc3VsdCIsImNvbnNvbGUiLCJsb2ciLCJhdmdDZW50cm9pZHMiLCJjZW50cm9pZHMiLCJ4IiwiaWR4cyIsIm5ld0lkeHMiLCJpIiwic29uZ0luZGV4IiwiY2x1c3RlckluZGV4IiwiYXZnQ2VudHJvaWQiLCJuZXdSb3ciLCJzb3J0IiwiYSIsImIiLCJzb25ncyIsInVyaSIsInRyYWNrVXJpcyIsInJlcGxhY2VtZW50UmVzdWx0IiwicmVwbGFjZVBsYXlsaXN0U29uZ3MiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoic3lJQWVZOzJGQWZaLEtBQU1BLENBQUFBLE9BQU8sMEJBQUdDLE9BQU8sQ0FBQyxXQUFELENBQVYsQ0FBYixDQUNBLEtBQU1DLENBQUFBLE9BQU8sMEJBQUdELE9BQU8sQ0FBQyxTQUFELENBQVYsQ0FBYixDQUNBLEtBQU0sQ0FBRUUsR0FBRiwyQkFBVUYsT0FBTyxDQUFDLFdBQUQsQ0FBakIsQ0FBTixDQUVBLFFBQVNHLENBQUFBLGlCQUFULENBQTJCQyxVQUEzQixDQUF1Q0MsS0FBdkMsQ0FBOENDLElBQTlDLENBQW9ELGlEQUNuRCxNQUFPLElBQUlDLENBQUFBLE9BQUosQ0FBWSxNQUFPQyxP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LENBQVcsQ0FBbEMsRUEvQzhDLHlCQWdEOUNiLE9BQU8sQ0FBQ0MsR0FBUixDQUFZSyxPQUFaLEVBRUEsR0FBSVMsQ0FBQUEsS0FBSywyQkFBRyxFQUFILENBQVQsQ0FsRDhDLHlCQW9EOUMsSUFBS1IsQ0FBQyxDQUFHLENBQVQsQ0FBWUEsQ0FBQyxDQUFHdEIsUUFBUSxDQUFDSyxjQUFULENBQXdCUSxNQUF4QyxDQUFnRFMsQ0FBQyxFQUFqRCxDQUFxRCwwQkFDcERRLEtBQUssQ0FBQ2hDLElBQU4sQ0FBV0UsUUFBUSxDQUFDSyxjQUFULENBQXdCZ0IsT0FBTyxDQUFDQyxDQUFELENBQVAsQ0FBVyxDQUFYLENBQXhCLEVBQXVDUyxHQUFsRCxFQUNBLENBQ0Q7QUFDQTtBQUVBLEdBQUlDLENBQUFBLFNBQVMsMkJBQUdGLEtBQUgsQ0FBYixDQUNBO0FBQ0E7QUFFQSxHQUFJRyxDQUFBQSxpQkFBaUIsMkJBQUcsS0FBTWpELENBQUFBLE9BQU8sQ0FBQ2tELG9CQUFSLENBQzdCN0MsVUFENkIsQ0FFN0IyQyxTQUY2QixDQUc3QjFDLEtBSDZCLENBQVQsQ0FBckIsQ0E5RDhDLHlCQW1FOUNHLE9BQU8sQ0FBQyxDQUFFUyxNQUFNLENBQUUrQixpQkFBaUIsQ0FBQy9CLE1BQTVCLENBQW9DQyxPQUFPLENBQUU4QixpQkFBN0MsQ0FBRCxDQUFQLENBQ0EsQ0FwRU0sQ0FBUCxDQXFFQSxDQUVEO0FBQ0E7QUFDQTtBQUNBO3lCQUVBRSxNQUFNLENBQUNDLE9BQVAsQ0FBaUIsQ0FDaEJoRCxpQkFDQTtBQUZnQixDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHNwb3RpZnkgPSByZXF1aXJlKFwiLi9zcG90aWZ5XCIpO1xyXG5jb25zdCBza21lYW5zID0gcmVxdWlyZShcInNrbWVhbnNcIik7XHJcbmNvbnN0IHsgbWFwIH0gPSByZXF1aXJlKFwiLi4vc2VydmVyXCIpO1xyXG5cclxuZnVuY3Rpb24gcmVhcnJhbmdlUGxheWxpc3QocGxheWxpc3RJZCwgdG9rZW4sIGRhdGEpIHtcclxuXHRyZXR1cm4gbmV3IFByb21pc2UoYXN5bmMgKHJlc29sdmUsIHJlamV4Y3QpID0+IHtcclxuXHRcdGxldCB0cmFja0lkcyA9IFtdO1xyXG5cdFx0ZGF0YS5mb3JFYWNoKCh0cmFjaykgPT4ge1xyXG5cdFx0XHR0cmFja0lkcy5wdXNoKHRyYWNrLnRyYWNrLmlkKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdC8vIHRyYWNrSWRzID0gcmVtb3ZlRHVwbGljYXRlcyh0cmFja0lkcyk7XHJcblxyXG5cdFx0bGV0IGZlYXR1cmVzID0gYXdhaXQgc3BvdGlmeS5nZXRGZWF0dXJlc09mVHJhY2tzKHRyYWNrSWRzLCB0b2tlbik7XHJcblx0XHRpZiAoZmVhdHVyZXMuc3RhdHVzKVxyXG5cdFx0XHRyZXNvbHZlKHtcclxuXHRcdFx0XHRzdGF0dXM6IGZlYXR1cmVzLnN0YXR1cyxcclxuXHRcdFx0XHRtZXNzYWdlOiBcIkNvdWxkbid0IGdldCB0aGUgZmVhdHVyZXM6IFwiICsgZmVhdHVyZXMuc3RhdHVzTWVzc2FnZSxcclxuXHRcdFx0fSk7XHJcblx0XHQvLyBjb25zb2xlLmxvZyhmZWF0dXJlcyk7XHJcblx0XHRkYXRhID0gW107XHJcblx0XHRmZWF0dXJlcy5hdWRpb19mZWF0dXJlcy5mb3JFYWNoKChmKSA9PiB7XHJcblx0XHRcdGxldCBuZXdEYXRhID0gW107XHJcblx0XHRcdG5ld0RhdGEucHVzaChmLmRhbmNlYWJpbGl0eSk7XHJcblx0XHRcdG5ld0RhdGEucHVzaChmLmVuZXJneSk7XHJcblx0XHRcdGRhdGEucHVzaChuZXdEYXRhKTtcclxuXHRcdH0pO1xyXG5cdFx0Ly8gY29uc29sZS5sb2coZGF0YSk7XHJcblxyXG5cdFx0bnVtT2ZDbHVzdGVycyA9IE1hdGguY2VpbChkYXRhLmxlbmd0aCAvIDMpO1xyXG5cdFx0Y2x1c3RlcmluZ1Jlc3VsdCA9IHNrbWVhbnMoZGF0YSwgbnVtT2ZDbHVzdGVycyk7XHJcblx0XHRjb25zb2xlLmxvZyhcIkNsdXN0ZXJpbmcgcmVzdWx0OiBcIik7XHJcblx0XHRjb25zb2xlLmxvZyhjbHVzdGVyaW5nUmVzdWx0KTtcclxuXHJcblx0XHRsZXQgYXZnQ2VudHJvaWRzID0gY2x1c3RlcmluZ1Jlc3VsdC5jZW50cm9pZHM7XHJcblx0XHRhdmdDZW50cm9pZHMgPSBhdmdDZW50cm9pZHMubWFwKCh4KSA9PiAoeFswXSArIHhbMV0pIC8gMik7XHJcblx0XHQvLyBjb25zb2xlLmxvZyhcIkNlbnRyb2lkczogXCIpXHJcblx0XHQvLyBjb25zb2xlLmxvZyhhdmdDZW50cm9pZHMpO1xyXG5cclxuXHRcdC8vIGkgYXNzaWduIHRvIGV2ZXJ5IGlkeCB0aGUgYXZlcmFnZSB2YWx1ZSBvZiB0aGUgY2VudHJvaWQsIHRoZW4gaSBzb3J0XHJcblx0XHQvLyB0aGUgbGlzdCBpbiBkZWNyZXNjZW50IG9yZGVyLlxyXG5cdFx0bGV0IGlkeHMgPSBjbHVzdGVyaW5nUmVzdWx0LmlkeHM7XHJcblx0XHRjb25zb2xlLmxvZyhpZHhzKTtcclxuXHJcblx0XHRsZXQgbmV3SWR4cyA9IFtdO1xyXG5cdFx0Zm9yIChpID0gMDsgaSA8IGlkeHMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0bGV0IHNvbmdJbmRleCA9IGk7XHJcblx0XHRcdGxldCBjbHVzdGVySW5kZXggPSBpZHhzW2ldO1xyXG5cdFx0XHRsZXQgYXZnQ2VudHJvaWQgPSBhdmdDZW50cm9pZHNbY2x1c3RlckluZGV4XTtcclxuXHRcdFx0bGV0IG5ld1JvdyA9IFtzb25nSW5kZXgsIGNsdXN0ZXJJbmRleCwgYXZnQ2VudHJvaWRdO1xyXG5cdFx0XHRuZXdJZHhzLnB1c2gobmV3Um93KTtcclxuXHRcdH1cclxuXHRcdG5ld0lkeHMuc29ydCgoYSwgYikgPT4gYlsyXSAtIGFbMl0pO1xyXG5cdFx0Y29uc29sZS5sb2cobmV3SWR4cyk7XHJcblxyXG5cdFx0bGV0IHNvbmdzID0gW107XHJcblxyXG5cdFx0Zm9yIChpID0gMDsgaSA8IGZlYXR1cmVzLmF1ZGlvX2ZlYXR1cmVzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdHNvbmdzLnB1c2goZmVhdHVyZXMuYXVkaW9fZmVhdHVyZXNbbmV3SWR4c1tpXVswXV0udXJpKTtcclxuXHRcdH1cclxuXHRcdC8vIGNvbnNvbGUubG9nKCdDbHVzdGVyczogJyk7XHJcblx0XHQvLyBjb25zb2xlLmxvZyhjbHVzdGVycyk7XHJcblxyXG5cdFx0bGV0IHRyYWNrVXJpcyA9IHNvbmdzO1xyXG5cdFx0Ly8gY29uc29sZS5sb2coXCJTb25ncyB1cmlzOiBcIik7XHJcblx0XHQvLyBjb25zb2xlLmxvZyh0cmFja1VyaXMpO1xyXG5cclxuXHRcdGxldCByZXBsYWNlbWVudFJlc3VsdCA9IGF3YWl0IHNwb3RpZnkucmVwbGFjZVBsYXlsaXN0U29uZ3MoXHJcblx0XHRcdHBsYXlsaXN0SWQsXHJcblx0XHRcdHRyYWNrVXJpcyxcclxuXHRcdFx0dG9rZW5cclxuXHRcdCk7XHJcblx0XHRyZXNvbHZlKHsgc3RhdHVzOiByZXBsYWNlbWVudFJlc3VsdC5zdGF0dXMsIG1lc3NhZ2U6IHJlcGxhY2VtZW50UmVzdWx0IH0pO1xyXG5cdH0pO1xyXG59XHJcblxyXG4vLyBmdW5jdGlvbiByZW1vdmVEdXBsaWNhdGVzKGFycmF5KSB7XHJcbi8vIFx0bGV0IG5ld0FycmF5ID0gYXJyYXkuZmlsdGVyKCh2LCBpKSA9PiBhcnJheS5pbmRleE9mKHYpID09IGkpO1xyXG4vLyBcdHJldHVybiBuZXdBcnJheTtcclxuLy8gfVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSB7XHJcblx0cmVhcnJhbmdlUGxheWxpc3QsXHJcblx0Ly8gcmVtb3ZlRHVwbGljYXRlcyxcclxufTtcclxuIl19