function cov_16c1db1u6m(){var path="D:\\Mag\\lets_party_together\\potential-badass-app\\server\\plugins\\listManager.js";var hash="a338ffcd3ab10f7f327b3b32e7035658deef4493";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\Mag\\lets_party_together\\potential-badass-app\\server\\plugins\\listManager.js",statementMap:{"0":{start:{line:1,column:16},end:{line:1,column:36}},"1":{start:{line:2,column:16},end:{line:2,column:34}},"2":{start:{line:3,column:16},end:{line:3,column:36}},"3":{start:{line:6,column:1},end:{line:95,column:4}},"4":{start:{line:13,column:17},end:{line:13,column:19}},"5":{start:{line:14,column:2},end:{line:16,column:5}},"6":{start:{line:15,column:3},end:{line:15,column:33}},"7":{start:{line:18,column:2},end:{line:18,column:40}},"8":{start:{line:20,column:17},end:{line:20,column:67}},"9":{start:{line:21,column:2},end:{line:25,column:6}},"10":{start:{line:22,column:3},end:{line:25,column:6}},"11":{start:{line:27,column:2},end:{line:27,column:12}},"12":{start:{line:28,column:2},end:{line:33,column:5}},"13":{start:{line:29,column:17},end:{line:29,column:19}},"14":{start:{line:30,column:3},end:{line:30,column:32}},"15":{start:{line:31,column:3},end:{line:31,column:26}},"16":{start:{line:32,column:3},end:{line:32,column:22}},"17":{start:{line:36,column:2},end:{line:36,column:45}},"18":{start:{line:37,column:2},end:{line:37,column:50}},"19":{start:{line:41,column:21},end:{line:41,column:47}},"20":{start:{line:42,column:2},end:{line:42,column:60}},"21":{start:{line:42,column:41},end:{line:42,column:58}},"22":{start:{line:49,column:13},end:{line:49,column:34}},"23":{start:{line:50,column:2},end:{line:50,column:20}},"24":{start:{line:52,column:16},end:{line:52,column:18}},"25":{start:{line:53,column:2},end:{line:59,column:3}},"26":{start:{line:54,column:19},end:{line:54,column:20}},"27":{start:{line:55,column:22},end:{line:55,column:29}},"28":{start:{line:56,column:21},end:{line:56,column:47}},"29":{start:{line:57,column:16},end:{line:57,column:54}},"30":{start:{line:58,column:3},end:{line:58,column:24}},"31":{start:{line:60,column:2},end:{line:60,column:38}},"32":{start:{line:60,column:25},end:{line:60,column:36}},"33":{start:{line:61,column:2},end:{line:61,column:23}},"34":{start:{line:68,column:14},end:{line:68,column:16}},"35":{start:{line:71,column:2},end:{line:73,column:3}},"36":{start:{line:72,column:3},end:{line:72,column:58}},"37":{start:{line:78,column:18},end:{line:78,column:23}},"38":{start:{line:86,column:2},end:{line:86,column:30}},"39":{start:{line:87,column:2},end:{line:87,column:25}},"40":{start:{line:89,column:26},end:{line:93,column:3}},"41":{start:{line:94,column:2},end:{line:94,column:76}},"42":{start:{line:99,column:16},end:{line:99,column:61}},"43":{start:{line:99,column:39},end:{line:99,column:60}},"44":{start:{line:100,column:1},end:{line:100,column:17}},"45":{start:{line:103,column:0},end:{line:106,column:2}}},fnMap:{"0":{name:"rearrangePlaylist",decl:{start:{line:5,column:9},end:{line:5,column:26}},loc:{start:{line:5,column:52},end:{line:96,column:1}},line:5},"1":{name:"(anonymous_1)",decl:{start:{line:6,column:20},end:{line:6,column:21}},loc:{start:{line:6,column:48},end:{line:95,column:2}},line:6},"2":{name:"(anonymous_2)",decl:{start:{line:14,column:15},end:{line:14,column:16}},loc:{start:{line:14,column:26},end:{line:16,column:3}},line:14},"3":{name:"(anonymous_3)",decl:{start:{line:28,column:34},end:{line:28,column:35}},loc:{start:{line:28,column:41},end:{line:33,column:3}},line:28},"4":{name:"(anonymous_4)",decl:{start:{line:42,column:34},end:{line:42,column:35}},loc:{start:{line:42,column:41},end:{line:42,column:58}},line:42},"5":{name:"(anonymous_5)",decl:{start:{line:60,column:15},end:{line:60,column:16}},loc:{start:{line:60,column:25},end:{line:60,column:36}},line:60},"6":{name:"removeDuplicates",decl:{start:{line:98,column:9},end:{line:98,column:25}},loc:{start:{line:98,column:33},end:{line:101,column:1}},line:98},"7":{name:"(anonymous_7)",decl:{start:{line:99,column:29},end:{line:99,column:30}},loc:{start:{line:99,column:39},end:{line:99,column:60}},line:99}},branchMap:{"0":{loc:{start:{line:21,column:2},end:{line:25,column:6}},type:"if",locations:[{start:{line:21,column:2},end:{line:25,column:6}},{start:{line:21,column:2},end:{line:25,column:6}}],line:21}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0},b:{"0":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a338ffcd3ab10f7f327b3b32e7035658deef4493"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_16c1db1u6m=function(){return actualCoverage;};}return actualCoverage;}cov_16c1db1u6m();const spotify=(cov_16c1db1u6m().s[0]++,require("./spotify"));const skmeans=(cov_16c1db1u6m().s[1]++,require("skmeans"));const{map}=(cov_16c1db1u6m().s[2]++,require("../server"));function rearrangePlaylist(playlistId,token,data){cov_16c1db1u6m().f[0]++;cov_16c1db1u6m().s[3]++;return new Promise(async(resolve,rejexct)=>{cov_16c1db1u6m().f[1]++;// let data = await spotify.getPlaylistItems(playlistId, token);
// // console.log(data);
// if (data.status)
//     resolve({status: data.status, message: "Couldn't get songs from playlist: " + data.statusMessage});
// if (data.length < 4)
//     resolve({status: 200, message: "Added new song."});
let trackIds=(cov_16c1db1u6m().s[4]++,[]);cov_16c1db1u6m().s[5]++;data.forEach(track=>{cov_16c1db1u6m().f[2]++;cov_16c1db1u6m().s[6]++;trackIds.push(track.track.id);});cov_16c1db1u6m().s[7]++;trackIds=removeDuplicates(trackIds);let features=(cov_16c1db1u6m().s[8]++,await spotify.getFeaturesOfTracks(trackIds,token));cov_16c1db1u6m().s[9]++;if(features.status){cov_16c1db1u6m().b[0][0]++;cov_16c1db1u6m().s[10]++;resolve({status:features.status,message:"Couldn't get the features: "+features.statusMessage});}else{cov_16c1db1u6m().b[0][1]++;}// console.log(features);
cov_16c1db1u6m().s[11]++;data=[];cov_16c1db1u6m().s[12]++;features.audio_features.forEach(f=>{cov_16c1db1u6m().f[3]++;let newData=(cov_16c1db1u6m().s[13]++,[]);cov_16c1db1u6m().s[14]++;newData.push(f.danceability);cov_16c1db1u6m().s[15]++;newData.push(f.energy);cov_16c1db1u6m().s[16]++;data.push(newData);});// console.log(data);
cov_16c1db1u6m().s[17]++;numOfClusters=Math.ceil(data.length/3);cov_16c1db1u6m().s[18]++;clusteringResult=skmeans(data,numOfClusters);// console.log('Clustering result: ');
// console.log(clusteringResult);
let avgCentroids=(cov_16c1db1u6m().s[19]++,clusteringResult.centroids);cov_16c1db1u6m().s[20]++;avgCentroids=avgCentroids.map(x=>{cov_16c1db1u6m().f[4]++;cov_16c1db1u6m().s[21]++;return(x[0]+x[1])/2;});// console.log("Centroids: ")
// console.log(avgCentroids);
// i assign to every idx the average value of the centroid, then i sort
// the list in decrescent order.
let idxs=(cov_16c1db1u6m().s[22]++,clusteringResult.idxs);cov_16c1db1u6m().s[23]++;console.log(idxs);// idxs = idxs.map(x => [x, avgCentroids[x]]);
let newIdxs=(cov_16c1db1u6m().s[24]++,[]);cov_16c1db1u6m().s[25]++;for(i=0;i<idxs.length;i++){let songIndex=(cov_16c1db1u6m().s[26]++,i);let clusterIndex=(cov_16c1db1u6m().s[27]++,idxs[i]);let avgCentroid=(cov_16c1db1u6m().s[28]++,avgCentroids[clusterIndex]);let newRow=(cov_16c1db1u6m().s[29]++,[songIndex,clusterIndex,avgCentroid]);cov_16c1db1u6m().s[30]++;newIdxs.push(newRow);}cov_16c1db1u6m().s[31]++;newIdxs.sort((a,b)=>{cov_16c1db1u6m().f[5]++;cov_16c1db1u6m().s[32]++;return b[2]-a[2];});cov_16c1db1u6m().s[33]++;console.log(newIdxs);// let clusters = [];
// for (i = 0; i < numOfClusters; i++ ) {
//     clusters[i] = [];
// }
let songs=(cov_16c1db1u6m().s[34]++,[]);// console.log(features.audio_features.length);
cov_16c1db1u6m().s[35]++;for(i=0;i<features.audio_features.length;i++){cov_16c1db1u6m().s[36]++;songs.push(features.audio_features[newIdxs[i][0]].uri);}// console.log('Clusters: ');
// console.log(clusters);
let trackUris=(cov_16c1db1u6m().s[37]++,songs);// let trackUris = [];
// clusters.forEach(cluster =>  {
//     cluster.forEach(element =>  {
//         trackUris.push(element);
//     })
// });
cov_16c1db1u6m().s[38]++;console.log("Songs uris: ");cov_16c1db1u6m().s[39]++;console.log(trackUris);let replacementResult=(cov_16c1db1u6m().s[40]++,await spotify.replacePlaylistSongs(playlistId,trackUris,token));cov_16c1db1u6m().s[41]++;resolve({status:replacementResult.status,message:replacementResult});});}function removeDuplicates(array){cov_16c1db1u6m().f[6]++;let newArray=(cov_16c1db1u6m().s[42]++,array.filter((v,i)=>{cov_16c1db1u6m().f[7]++;cov_16c1db1u6m().s[43]++;return array.indexOf(v)==i;}));cov_16c1db1u6m().s[44]++;return newArray;}cov_16c1db1u6m().s[45]++;module.exports={rearrangePlaylist,removeDuplicates};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpc3RNYW5hZ2VyLmpzIl0sIm5hbWVzIjpbInNwb3RpZnkiLCJyZXF1aXJlIiwic2ttZWFucyIsIm1hcCIsInJlYXJyYW5nZVBsYXlsaXN0IiwicGxheWxpc3RJZCIsInRva2VuIiwiZGF0YSIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZXhjdCIsInRyYWNrSWRzIiwiZm9yRWFjaCIsInRyYWNrIiwicHVzaCIsImlkIiwicmVtb3ZlRHVwbGljYXRlcyIsImZlYXR1cmVzIiwiZ2V0RmVhdHVyZXNPZlRyYWNrcyIsInN0YXR1cyIsIm1lc3NhZ2UiLCJzdGF0dXNNZXNzYWdlIiwiYXVkaW9fZmVhdHVyZXMiLCJmIiwibmV3RGF0YSIsImRhbmNlYWJpbGl0eSIsImVuZXJneSIsIm51bU9mQ2x1c3RlcnMiLCJNYXRoIiwiY2VpbCIsImxlbmd0aCIsImNsdXN0ZXJpbmdSZXN1bHQiLCJhdmdDZW50cm9pZHMiLCJjZW50cm9pZHMiLCJ4IiwiaWR4cyIsImNvbnNvbGUiLCJsb2ciLCJuZXdJZHhzIiwiaSIsInNvbmdJbmRleCIsImNsdXN0ZXJJbmRleCIsImF2Z0NlbnRyb2lkIiwibmV3Um93Iiwic29ydCIsImEiLCJiIiwic29uZ3MiLCJ1cmkiLCJ0cmFja1VyaXMiLCJyZXBsYWNlbWVudFJlc3VsdCIsInJlcGxhY2VQbGF5bGlzdFNvbmdzIiwiYXJyYXkiLCJuZXdBcnJheSIsImZpbHRlciIsInYiLCJpbmRleE9mIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6InUySkFlWTsyRkFmWixLQUFNQSxDQUFBQSxPQUFPLDBCQUFHQyxPQUFPLENBQUMsV0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNQyxDQUFBQSxPQUFPLDBCQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNLENBQUVFLEdBQUYsMkJBQVVGLE9BQU8sQ0FBQyxXQUFELENBQWpCLENBQU4sQ0FFQSxRQUFTRyxDQUFBQSxpQkFBVCxDQUEyQkMsVUFBM0IsQ0FBdUNDLEtBQXZD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Q0MsQ0FBRCxDQUFJaEIsQ0FBSixHQUFVLHdEQUFBYSxDQUFBQSxLQUFLLENBQUNJLE9BQU4sQ0FBY0QsQ0FBZCxHQUFvQmhCLENBQXBCLENBQXFCLENBQTVDLENBQUgsQ0FBWixDQURnQyx5QkFFaEMsTUFBT2MsQ0FBQUEsUUFBUCxDQUNBLEMseUJBRURJLE1BQU0sQ0FBQ0MsT0FBUCxDQUFpQixDQUNoQnRELGlCQURnQixDQUVoQlksZ0JBRmdCLENBQWpCIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc3BvdGlmeSA9IHJlcXVpcmUoXCIuL3Nwb3RpZnlcIik7XHJcbmNvbnN0IHNrbWVhbnMgPSByZXF1aXJlKFwic2ttZWFuc1wiKTtcclxuY29uc3QgeyBtYXAgfSA9IHJlcXVpcmUoXCIuLi9zZXJ2ZXJcIik7XHJcblxyXG5mdW5jdGlvbiByZWFycmFuZ2VQbGF5bGlzdChwbGF5bGlzdElkLCB0b2tlbiwgZGF0YSkge1xyXG5cdHJldHVybiBuZXcgUHJvbWlzZShhc3luYyAocmVzb2x2ZSwgcmVqZXhjdCkgPT4ge1xyXG5cdFx0Ly8gbGV0IGRhdGEgPSBhd2FpdCBzcG90aWZ5LmdldFBsYXlsaXN0SXRlbXMocGxheWxpc3RJZCwgdG9rZW4pO1xyXG5cdFx0Ly8gLy8gY29uc29sZS5sb2coZGF0YSk7XHJcblx0XHQvLyBpZiAoZGF0YS5zdGF0dXMpXHJcblx0XHQvLyAgICAgcmVzb2x2ZSh7c3RhdHVzOiBkYXRhLnN0YXR1cywgbWVzc2FnZTogXCJDb3VsZG4ndCBnZXQgc29uZ3MgZnJvbSBwbGF5bGlzdDogXCIgKyBkYXRhLnN0YXR1c01lc3NhZ2V9KTtcclxuXHRcdC8vIGlmIChkYXRhLmxlbmd0aCA8IDQpXHJcblx0XHQvLyAgICAgcmVzb2x2ZSh7c3RhdHVzOiAyMDAsIG1lc3NhZ2U6IFwiQWRkZWQgbmV3IHNvbmcuXCJ9KTtcclxuXHRcdGxldCB0cmFja0lkcyA9IFtdO1xyXG5cdFx0ZGF0YS5mb3JFYWNoKCh0cmFjaykgPT4ge1xyXG5cdFx0XHR0cmFja0lkcy5wdXNoKHRyYWNrLnRyYWNrLmlkKTtcclxuXHRcdH0pO1xyXG5cclxuXHRcdHRyYWNrSWRzID0gcmVtb3ZlRHVwbGljYXRlcyh0cmFja0lkcyk7XHJcblxyXG5cdFx0bGV0IGZlYXR1cmVzID0gYXdhaXQgc3BvdGlmeS5nZXRGZWF0dXJlc09mVHJhY2tzKHRyYWNrSWRzLCB0b2tlbik7XHJcblx0XHRpZiAoZmVhdHVyZXMuc3RhdHVzKVxyXG5cdFx0XHRyZXNvbHZlKHtcclxuXHRcdFx0XHRzdGF0dXM6IGZlYXR1cmVzLnN0YXR1cyxcclxuXHRcdFx0XHRtZXNzYWdlOiBcIkNvdWxkbid0IGdldCB0aGUgZmVhdHVyZXM6IFwiICsgZmVhdHVyZXMuc3RhdHVzTWVzc2FnZSxcclxuXHRcdFx0fSk7XHJcblx0XHQvLyBjb25zb2xlLmxvZyhmZWF0dXJlcyk7XHJcblx0XHRkYXRhID0gW107XHJcblx0XHRmZWF0dXJlcy5hdWRpb19mZWF0dXJlcy5mb3JFYWNoKChmKSA9PiB7XHJcblx0XHRcdGxldCBuZXdEYXRhID0gW107XHJcblx0XHRcdG5ld0RhdGEucHVzaChmLmRhbmNlYWJpbGl0eSk7XHJcblx0XHRcdG5ld0RhdGEucHVzaChmLmVuZXJneSk7XHJcblx0XHRcdGRhdGEucHVzaChuZXdEYXRhKTtcclxuXHRcdH0pO1xyXG5cdFx0Ly8gY29uc29sZS5sb2coZGF0YSk7XHJcblxyXG5cdFx0bnVtT2ZDbHVzdGVycyA9IE1hdGguY2VpbChkYXRhLmxlbmd0aCAvIDMpO1xyXG5cdFx0Y2x1c3RlcmluZ1Jlc3VsdCA9IHNrbWVhbnMoZGF0YSwgbnVtT2ZDbHVzdGVycyk7XHJcblx0XHQvLyBjb25zb2xlLmxvZygnQ2x1c3RlcmluZyByZXN1bHQ6ICcpO1xyXG5cdFx0Ly8gY29uc29sZS5sb2coY2x1c3RlcmluZ1Jlc3VsdCk7XHJcblxyXG5cdFx0bGV0IGF2Z0NlbnRyb2lkcyA9IGNsdXN0ZXJpbmdSZXN1bHQuY2VudHJvaWRzO1xyXG5cdFx0YXZnQ2VudHJvaWRzID0gYXZnQ2VudHJvaWRzLm1hcCgoeCkgPT4gKHhbMF0gKyB4WzFdKSAvIDIpO1xyXG5cclxuXHRcdC8vIGNvbnNvbGUubG9nKFwiQ2VudHJvaWRzOiBcIilcclxuXHRcdC8vIGNvbnNvbGUubG9nKGF2Z0NlbnRyb2lkcyk7XHJcblxyXG5cdFx0Ly8gaSBhc3NpZ24gdG8gZXZlcnkgaWR4IHRoZSBhdmVyYWdlIHZhbHVlIG9mIHRoZSBjZW50cm9pZCwgdGhlbiBpIHNvcnRcclxuXHRcdC8vIHRoZSBsaXN0IGluIGRlY3Jlc2NlbnQgb3JkZXIuXHJcblx0XHRsZXQgaWR4cyA9IGNsdXN0ZXJpbmdSZXN1bHQuaWR4cztcclxuXHRcdGNvbnNvbGUubG9nKGlkeHMpO1xyXG5cdFx0Ly8gaWR4cyA9IGlkeHMubWFwKHggPT4gW3gsIGF2Z0NlbnRyb2lkc1t4XV0pO1xyXG5cdFx0bGV0IG5ld0lkeHMgPSBbXTtcclxuXHRcdGZvciAoaSA9IDA7IGkgPCBpZHhzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdGxldCBzb25nSW5kZXggPSBpO1xyXG5cdFx0XHRsZXQgY2x1c3RlckluZGV4ID0gaWR4c1tpXTtcclxuXHRcdFx0bGV0IGF2Z0NlbnRyb2lkID0gYXZnQ2VudHJvaWRzW2NsdXN0ZXJJbmRleF07XHJcblx0XHRcdGxldCBuZXdSb3cgPSBbc29uZ0luZGV4LCBjbHVzdGVySW5kZXgsIGF2Z0NlbnRyb2lkXTtcclxuXHRcdFx0bmV3SWR4cy5wdXNoKG5ld1Jvdyk7XHJcblx0XHR9XHJcblx0XHRuZXdJZHhzLnNvcnQoKGEsIGIpID0+IGJbMl0gLSBhWzJdKTtcclxuXHRcdGNvbnNvbGUubG9nKG5ld0lkeHMpO1xyXG5cclxuXHRcdC8vIGxldCBjbHVzdGVycyA9IFtdO1xyXG5cdFx0Ly8gZm9yIChpID0gMDsgaSA8IG51bU9mQ2x1c3RlcnM7IGkrKyApIHtcclxuXHRcdC8vICAgICBjbHVzdGVyc1tpXSA9IFtdO1xyXG5cdFx0Ly8gfVxyXG5cclxuXHRcdGxldCBzb25ncyA9IFtdO1xyXG5cclxuXHRcdC8vIGNvbnNvbGUubG9nKGZlYXR1cmVzLmF1ZGlvX2ZlYXR1cmVzLmxlbmd0aCk7XHJcblx0XHRmb3IgKGkgPSAwOyBpIDwgZmVhdHVyZXMuYXVkaW9fZmVhdHVyZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdFx0c29uZ3MucHVzaChmZWF0dXJlcy5hdWRpb19mZWF0dXJlc1tuZXdJZHhzW2ldWzBdXS51cmkpO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGNvbnNvbGUubG9nKCdDbHVzdGVyczogJyk7XHJcblx0XHQvLyBjb25zb2xlLmxvZyhjbHVzdGVycyk7XHJcblxyXG5cdFx0bGV0IHRyYWNrVXJpcyA9IHNvbmdzO1xyXG5cclxuXHRcdC8vIGxldCB0cmFja1VyaXMgPSBbXTtcclxuXHRcdC8vIGNsdXN0ZXJzLmZvckVhY2goY2x1c3RlciA9PiAge1xyXG5cdFx0Ly8gICAgIGNsdXN0ZXIuZm9yRWFjaChlbGVtZW50ID0+ICB7XHJcblx0XHQvLyAgICAgICAgIHRyYWNrVXJpcy5wdXNoKGVsZW1lbnQpO1xyXG5cdFx0Ly8gICAgIH0pXHJcblx0XHQvLyB9KTtcclxuXHRcdGNvbnNvbGUubG9nKFwiU29uZ3MgdXJpczogXCIpO1xyXG5cdFx0Y29uc29sZS5sb2codHJhY2tVcmlzKTtcclxuXHJcblx0XHRsZXQgcmVwbGFjZW1lbnRSZXN1bHQgPSBhd2FpdCBzcG90aWZ5LnJlcGxhY2VQbGF5bGlzdFNvbmdzKFxyXG5cdFx0XHRwbGF5bGlzdElkLFxyXG5cdFx0XHR0cmFja1VyaXMsXHJcblx0XHRcdHRva2VuXHJcblx0XHQpO1xyXG5cdFx0cmVzb2x2ZSh7IHN0YXR1czogcmVwbGFjZW1lbnRSZXN1bHQuc3RhdHVzLCBtZXNzYWdlOiByZXBsYWNlbWVudFJlc3VsdCB9KTtcclxuXHR9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gcmVtb3ZlRHVwbGljYXRlcyhhcnJheSkge1xyXG5cdGxldCBuZXdBcnJheSA9IGFycmF5LmZpbHRlcigodiwgaSkgPT4gYXJyYXkuaW5kZXhPZih2KSA9PSBpKTtcclxuXHRyZXR1cm4gbmV3QXJyYXk7XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG5cdHJlYXJyYW5nZVBsYXlsaXN0LFxyXG5cdHJlbW92ZUR1cGxpY2F0ZXMsXHJcbn07XHJcbiJdfQ==